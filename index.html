<!--
	Project by Tavius Koktavy with Jump into the Light for Eric Bellinger's ad campaign - github: https://github.com/kotavy/eric-bellinger-ar
	AR.js by @jerome_etienne - github: https://github.com/jeromeetienne/ar.js - info: https://medium.com/arjs/augmented-reality-in-10-lines-of-html-4e193ea9fdbf
-->

<head>
	<script src='https://aframe.io/releases/0.8.2/aframe.min.js'></script>
	<script src='aframe-ar.js'></script>
	<!-- Incorporating these modifications to reduce jitter: https://github.com/jeromeetienne/AR.js/pull/422/commits/7e247677f563e7858388b00eb46c226c92874bb5 -->
	<script>
		var constraints = { audio: false, video: true };

		navigator.mediaDevices.getUserMedia(constraints).then(function(mediaStream) {
			console.log("camera access granted");
			document.querySelector('#camAccess').setAttribute('visible', false);
			document.querySelector('#tutorial').setAttribute('visible', true);
		});

		var looped = false;

		AFRAME.registerComponent('registerevents', {
			init: function() {
				var marker = this.el;
				var plane = marker.firstElementChild;

				marker.addEventListener('markerFound', function() {
						document.querySelector('#tempGraphic').setAttribute('visible', false);
						document.querySelector('#tutorial').setAttribute('visible', false);
						if (!looped) {
							looped = true;
							updatePageStatus();
						}
				});

				marker.addEventListener('markerLost', function() {
					let tempPosition = document.querySelector('#marker').getAttribute('position');
					document.querySelector('#tempGraphic').setAttribute('position', tempPosition);
					document.querySelector('#tempGraphic').setAttribute('visible', true);
				});
			}
		});

		function updatePageStatus() {
			window.setTimeout(function() {
					alert('video done, redirect or offer link?');
			}, 10000);
		}

		function clickHandler() {
			window.location = urlFront + imgSrc;
		}
	</script>
</head>

<body style='margin : 0px; overflow: hidden;'>
	<a-scene embedded arjs='debugUIEnabled: false; patternRatio: 0.97; detectionMode: mono;' keyboard-shortcuts='enterVR: false' vr-mode-ui='enabled: false'>
		<a-assets>
			<img id="graphic" src="spaceman.jpg">
			<video id="eb-vid" autoplay loop="true" src="eb-vid.mp4"></video>
		</a-assets>

		<a-text id="camAccess" value="AR requires camera access" position="0, -1.5, -8" align="center" color="black"></a-text>
		<a-text id="tutorial" value="SCAN AR MARKER" position="0, -1.5, -8" align="center" visible="false"></a-text>

		<a-marker id='marker' registerevents emitevents='true' type='pattern' url='eb-test-inner.patt' minconfidence='0.5'>
			<a-video id='arVid' src='#eb-vid' width="2" height="2" position="0 0 0" rotation='-90 0 0'></a-video>
			<!-- <a-plane id='arGraphic' cursor='rayOrigin: mouse; fuse: false' position='0 0 0' rotation='-90 0 0' width='2' height='2' material='side:double; src: #graphic'></a-plane> -->
		</a-marker>

		<a-plane id='tempGraphic' position='0 0 0' rotation='0 0 0' width='2' height='2' material='side:double; src: #graphic'></a-plane>

		<a-entity camera></a-entity>
	</a-scene>

	<!-- <script>
		document.querySelector('#marker').setAttribute('visible', false);
	</script> -->
</body>
